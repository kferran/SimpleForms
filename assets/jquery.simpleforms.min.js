/*--
 * SimpleForms for ProcessWire
 * A simple form processor. Uses AJAX, configurable with JSON. Front-end is up to you.
 *
 * Front-end jQuery plugin
 *
 * Copyright (c) 2015, Mike Rockett. All Rights Reserved.
 * Licence: MIT License - http://mit-license.org/
 */
!function(e,t){var n=function(){for(var e=arguments[0],t="ucfirst",n=0;n<arguments.length-1;n++){var r=new RegExp("\\{("+t+":)?"+n+"\\}","igm"),s=new RegExp("\\[([a-z]+)\\|([a-z]+):("+n+")\\]","igm"),i=arguments[n+1];e.match(r)&&e.match(r)[0].indexOf(t)>=0&&(i=i.charAt(0).toUpperCase()+i.slice(1)),e=e.replace(r,i),e.match(s)&&(e=e.replace(s,1===i||"one"===i.toLowerCase()?"$1":"$2"))}return e},r=function(e,t){("undefined"==typeof t||null===t)&&(t=!0);var r="data-sf-"+e;return t===!0&&(r=n("[{0}]",r)),r},s=function(e){var t=["","thousand","million","billion","trillion"],n=["zero","one","two","three","four","five","six","seven","eight","nine"],r=["ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],s=["twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"];if(e=e.toString(),e=e.replace(/[\, ]/g,""),e!=parseFloat(e))return"not a number";var i=e.indexOf(".");if(-1==i&&(i=e.length),i>15)return"too big";for(var a=e.split(""),o="",u=0,l=0;i>l;l++)(i-l)%3==2?"1"==a[l]?(o+=r[Number(a[l+1])]+" ",l++,u=1):0!=a[l]&&(o+=s[a[l]-2]+" ",u=1):0!=a[l]&&(o+=n[a[l]]+" ",(i-l)%3==0&&(o+="hundred "),u=1),(i-l)%3==1&&(u&&(o+=t[(i-l-1)/3]+" "),u=0);if(i!=e.length){var c=e.length;o+="point ";for(var l=i+1;c>l;l++)o+=n[a[l]]+" "}return o.replace(/\s+/g," ").trim()};e.fn.sf_serialiseObject=function(){var t={},n=this.serializeArray();return e.each(n,function(){void 0!==t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""}),t};var i=function(e){if(Object.keys)return Object.keys(e).length;var t=0;for(var n in e)this.hasOwnProperty(n)&&t++;return t};e.fn.prepareSimpleForms=function(t){var a={interimButtonText:"Just a moment...",logErrors:!0,processingClass:"processing",scroll:{enabled:!0,offset:0,duration:500,easing:"swing"},serverErrorAlert:"Something went wrong on the server, and so this form could not be submitted. The form has been left as-is so that you may leave it open and try again in a few minutes.",events:{submitStart:function(e){},submitEnd:function(e){},success:null,failure:null,serverError:null}},o=e.extend(!0,a,t),u=this;e.each(["inputmask|mask","formatter|pattern"],function(t,r){var r=r.split("|"),s=r[0],i=r[1];o[s]&&e.fn[s]&&e.each(o[s],function(t,r){if("string"===e.type(r)){var a=r,r={};r[i]=a}e(n("[name={0}]",t),u)[s](r)})}),e("input[type=submit]",this).val(function(){return e(this).data("value")}),this.on("submit",function(t){t.preventDefault();var a=new FormData(u[0]),l=function(t){var n=e(":input",u);switch(t){case 0:n.prop("disabled",!0);break;case 1:n.prop("disabled",!1)}},c=function(){u.addClass(o.processingClass),l(0),e("input[type=submit]",u).val(o.interimButtonText),e.isFunction(o.events.submitStart)&&o.events.submitStart(u)},f=function(){u.removeClass(o.processingClass),l(1),e("input[type=submit]",u).val(function(){return e(this).data("value")}),e.isFunction(o.events.submitEnd)&&o.events.submitEnd(u)};return c(),e.ajax(u.attr("action"),{async:!0,data:a,processData:!1,contentType:!1,dataType:"json",type:"post",method:"post",statusCode:{500:function(t){var n=e.parseJSON(t.responseText);o.logErrors===!0&&console.log(n.error),e.isFunction(o.events.serverError)?o.events.serverError(n.error):alert(o.serverErrorAlert)},422:function(t){var a=e.parseJSON(t.responseText),l=a.errors,c=i(l),f=s(c),m=n(a.error,f,c);e.isFunction(o.events.failure)?o.events.failure(u,l,m):(e(r("formerror"),u).hide().html(m).show(),e(r("fielderror"),u).hide(),e(":input",u).removeAttr(r("fieldhaserror",!1)),e.each(l,function(t,s){s instanceof Array&&console.log(s[0]);var i=n("[name={0}]",t);e(i,u).attr(r("fieldhaserror",!1),""),e(n("[{0}={1}]",r("fielderror",!1),t),u).html(s).show()}));var v=function(){for(var e in l)return e};e(n("[name={0}]",v()),u).focus()},200:function(t){e.isFunction(o.events.success)?o.events.success(u,t.success):u.html(n('<div data-sf-success class="sfSuccessMessage">{0}</div>',t.success))}}}).always(function(){o.scroll.enabled&&e("html,body").animate({scrollTop:u.offset().top-o.scroll.offset},{duration:o.scroll.duration,easing:o.scroll.easing}),f()}),!0})},t.allSimpleForms=function(){return"[data-sf!=''][data-sf]"},t.simpleForms=function(t){e(allSimpleForms()).prepareSimpleForms(t)}}(jQuery,window);