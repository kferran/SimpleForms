/*--
 * SimpleForms for ProcessWire
 * A simple form processor. Uses AJAX, configurable with JSON. Front-end is up to you.
 *
 * Front-end jQuery plugin
 *
 * Copyright (c) 2015, Mike Rockett. All Rights Reserved.
 * Licence: MIT License - http://mit-license.org/
 */
!function(e,t){var r=function(){for(var e=arguments[0],t="ucfirst",r=0;r<arguments.length-1;r++){var n=new RegExp("\\{("+t+":)?"+r+"\\}","gm"),i=new RegExp("\\[([a-z]+)\\|([a-z]+):("+r+")\\]","gmi"),o=arguments[r+1];e.match(n)&&e.match(n)[0].indexOf(t)>=0&&(o=o.charAt(0).toUpperCase()+o.slice(1)),e=e.replace(n,o),e.match(i)&&(e=e.replace(i,1===o||"one"===o.toLowerCase()?"$1":"$2"))}return e},n=function(e,t){("undefined"==typeof t||null===t)&&(t=!0);var n="data-simpleforms-"+e;return t===!0&&(n=r("[{0}]",n)),n},i=function(e){var t=["","thousand","million","billion","trillion"],r=["zero","one","two","three","four","five","six","seven","eight","nine"],n=["ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],i=["twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"];if(e=e.toString(),e=e.replace(/[\, ]/g,""),e!=parseFloat(e))return"not a number";var o=e.indexOf(".");if(-1==o&&(o=e.length),o>15)return"too big";for(var a=e.split(""),s="",u=0,l=0;o>l;l++)(o-l)%3==2?"1"==a[l]?(s+=n[Number(a[l+1])]+" ",l++,u=1):0!=a[l]&&(s+=i[a[l]-2]+" ",u=1):0!=a[l]&&(s+=r[a[l]]+" ",(o-l)%3==0&&(s+="hundred "),u=1),(o-l)%3==1&&(u&&(s+=t[(o-l-1)/3]+" "),u=0);if(o!=e.length){var f=e.length;s+="point ";for(var l=o+1;f>l;l++)s+=r[a[l]]+" "}return s.replace(/\s+/g," ").trim()};e.fn.sf_serialiseObject=function(){var t={},r=this.serializeArray();return e.each(r,function(){void 0!==t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""}),t};var o=function(e){if(Object.keys)return Object.keys(e).length;var t=0;for(var r in e)this.hasOwnProperty(r)&&t++;return t};e.fn.prepareSimpleForms=function(t){var a={interimButtonText:"Just a moment...",serverErrorAlert:"Something went wrong on the server, and so this form could not be submitted. The form has been left as-is so that you may leave it open and try again in a few minutes.",scrollTime:500,onSubmitStart:function(){},onSubmitEnd:function(){},onServerError:null},s=e.extend(a,t);e("input[type=submit]",this).val(function(){return e(this).data("value")}),this.on("submit",function(t){t.preventDefault();var a=e(this),u=a.sf_serialiseObject(),l=function(t){var r=e(":input",a);switch(t){case 0:r.prop("disabled",!0);break;case 1:r.prop("disabled",!1)}},f=function(){l(0),e("input[type=submit]").val(s.interimButtonText),e.isFunction(s.onSubmitStart)&&s.onSubmitStart()},m=function(){l(1),e("input[type=submit]",a).val(function(){return e(this).data("value")}),e.isFunction(s.onSubmitEnd)&&s.onSubmitEnd()};return f(),e.ajax({async:!0,data:u,dataType:"json",global:!1,type:"post",method:"post",url:a.attr("action"),statusCode:{500:function(){e.isFunction(s.onServerError)?s.onServerError():alert(s.serverErrorAlert)},422:function(t){var s=e.parseJSON(t.responseText),u=s.errors,l=o(u),f=i(l),m=r(s.error,f,l);e(n("formerror"),a).hide().html(m).show(),e(n("fielderror"),a).hide(),e(":input",a).removeAttr(n("fieldhaserror",!1)),e.each(u,function(t,i){i instanceof Array&&console.log(i[0]);var o=r("[name={0}]",t);e(o,a).attr(n("fieldhaserror",!1),""),e(r("[{0}={1}]",n("fielderror",!1),t),a).html(i).show()});var c=function(){for(var e in u)return e};e(r("[name={0}]",c()),a).focus()}}}).always(function(){e("html, body").animate({scrollTop:a.offset().top},s.scrollTime),m()}),!0})},t.allSimpleForms=function(){return"[data-simpleforms!=''][data-simpleforms]"},t.simpleForms=function(t){e(allSimpleForms()).prepareSimpleForms()}}(jQuery,window);